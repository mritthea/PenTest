#!/bin/bash

# Variables
network_range=""
output_dir=""
scan_type=""
password_list=""

# Functions

# Function to display the menu
display_menu() {
  clear
  echo "===== Hacke ======"
  echo "1. Basic Scan"
  echo "2. Full Scan"
  echo "3. Exit"
  echo "=================="
  echo "Enter your choice: "
  read choice
}

# Function to get user input
get_user_input() {
  echo "Enter the network range (e.g., 192.168.1.0/24):"
  read network_range

  echo "Enter the name for the output directory:"
  read output_dir
}

# Function to validate input
validate_input() {
  if [[ -z "$network_range" || -z "$output_dir" ]]; then
    echo "Invalid input. Please provide all required information."
    exit 1
  fi
}

# Function to create output directory
create_output_dir() {
  if [ ! -d "$output_dir" ]; then
    mkdir -p "$output_dir"
  fi
}

# Function to perform network scanning
network_scan() {
  if [[ $scan_type == "Basic" ]]; then
    nmap -sS -sU -A -oN "$output_dir/basic_scan.txt" "$network_range"
  elif [[ $scan_type == "Full" ]]; then
    nmap -sS -sU -A -sC -oN "$output_dir/full_scan.txt" "$network_range"
    nmap --script vuln -oN "$output_dir/vuln_scan.txt" "$network_range"
  fi
}

# Function to check for weak passwords
check_weak_passwords() {
  echo "Checking for weak passwords..."
  for service in ssh rdp ftp telnet; do
    if [[ $service == "ssh" ]]; then
      hydra -L userlist.txt -P "$password_list" -o "$output_dir/hydra_ssh.txt" -t 4 ssh://"$network_range"
    elif [[ $service == "rdp" ]]; then
      hydra -L userlist.txt -P "$password_list" -o "$output_dir/hydra_rdp.txt" -t 4 rdp://"$network_range"
    elif [[ $service == "ftp" ]]; then
      hydra -L userlist.txt -P "$password_list" -o "$output_dir/hydra_ftp.txt" -t 4 ftp://"$network_range"
    elif [[ $service == "telnet" ]]; then
      hydra -L userlist.txt -P "$password_list" -o "$output_dir/hydra_telnet.txt" -t 4 telnet://"$network_range"
    fi
  done
}

# Function to map vulnerabilities
map_vulnerabilities() {
  echo "Mapping vulnerabilities..."
  searchsploit --nmap "$output_dir/full_scan.txt" > "$output_dir/searchsploit_results.txt"
}

# Function to log results
log_results() {
  echo "Logging results..."
  cat "$output_dir"/*.txt > "$output_dir/summary.txt"
  zip -r "$output_dir/results.zip" "$output_dir"
}

# Main Script Execution

echo "Enter the network range (e.g., 192.168.1.0/24):"
read network_range

echo "Enter the name for the output directory:"
read output_dir

validate_input
create_output_dir

while true; do
  display_menu
  case $choice in
    1)
      scan_type="Basic"
      network_scan
      ;;
    2)
      scan_type="Full"
      echo "Do you want to use the default password list or a custom one? (default/custom)"
      read pw_list_choice
      if [[ $pw_list_choice == "custom" ]]; then
        echo "Enter the path to your custom password list:"
        read password_list
      else
        password_list="./def_pass.txt" # Default password list
      fi
      network_scan
      check_weak_passwords
      map_vulnerabilities
      ;;
    3)
      exit 0
      ;;
    *)
      echo "Invalid choice, please try again."
      ;;
  esac
  log_results
  echo "Scan complete. Results saved in $output_dir."
done
